# Glen Ogilvie - nelg@mageia.org
# April 2013


= For this to work on Mageia 2/3
== KVM

Ensure that libvirtd is running, and that you have hardware support for libvirtd.
Set the permissions on /dev/kvm for the user you are running the test under, for example:

  setfacl -m "user:test:rw" /dev/kvm
  su - test
  cd tmp
  ../os-autoinst/tools/isotovideo Mageia-3-beta4-x86_64-DVD.iso

Provided that os-autoinst is in ~test/ and the iso is in ~test/tmp/

=== Required RPMs
  urpmi swig perl-Data-Dump
  urpmi perl-devel
  urpmi ffmpeg2theora
  urpmi tigervnc
  urpmi perl-Inline
  urpmi mtools

==== Mageia 3 (Optional, for openvc support)
  urpmi opencv-devel
  urpmi lib64opencv_nonfree

== env
This instructions assumes you are going to use a user on your system called test,
and that you have your hypervisor setup, see above:

0.  Switch to your test user:
  su - test
1.  Download os-autoinst, using git:
  git clone git://github.com/nelg/os-autoinst.git
2.  Download, or place a copy of Mageia-3-beta4-x86_64-DVD.iso or simular into ~test/tmp
  cd ~/tmp
  wget ..
3.  Ensure you have at least 8gb free disk space.
  df -h
4.  Copy the enviroment file to ~/tmp
  cd ~/tmp
  cp ~/os-autoinst/env-mageia.sh.sample env.sh
  vi env.sh (See comments within file)
5.  Run the test
  ../os-autoinst/tools/isotovideo Mageia-3-beta4-x86_64-DVD.iso

== watching the test
To watch the test, use
  vncviewer -PreferredEncoding=raw localhost:99

Note, the -PreferredEncoding=raw flag is really important.  Without this, your CPU usage will rocket up and the waitidle tests will generally fail, which will tend to cause the automated install to not work very well.


To watch after the test has run, use:
  mplayer video/Mageia-3-beta4-x86_64-DVD.ogv
You can step through individual frames after pausing it, using the . key.

== Editing the tests
Tests can be edited by editing ~/os-autoinst/distri/mageia/inst.d/
Also, general behavour of the tests can be changed by editing env.sh, where the tests support it.  Currently, read the source to find out.




